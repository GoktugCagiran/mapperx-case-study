var toGeoJSON=function(){"use strict";var D,pe=/\s*/g,he=/^\s*|\s*$/g,ce=/\s+/;function J(e){if(!e||!e.length)return 0;for(var i=0,o=0;i<e.length;i++)o=(o<<5)-o+e.charCodeAt(i)|0;return o}function d(e,i){return e.getElementsByTagName(i)}function L(e,i){return e.getAttribute(i)}function V(e,i){return parseFloat(L(e,i))}function r(e,i){var o=d(e,i);return o.length?o[0]:null}function $(e){for(var i=0,o=[];i<e.length;i++)o[i]=parseFloat(e[i]);return o}function l(e){return e&&function me(e){e.normalize&&e.normalize()}(e),e&&e.textContent||""}function B(e,i){var y,v,o={};for(v=0;v<i.length;v++)(y=r(e,i[v]))&&(o[i[v]]=l(y));return o}function U(e,i){for(var o in i)e[o]=i[o]}function j(e){return $(e.replace(pe,"").split(","))}function K(e){for(var i=e.replace(he,"").split(ce),o=[],y=0;y<i.length;y++)o.push(j(i[y]));return o}function Q(e){var S,i=[V(e,"lon"),V(e,"lat")],o=r(e,"ele"),y=r(e,"gpxtpx:hr")||r(e,"hr"),v=r(e,"time");return o&&(S=parseFloat(l(o)),isNaN(S)||i.push(S)),{coordinates:i,time:v?l(v):null,heartRate:y?parseFloat(l(y)):null}}if(typeof XMLSerializer<"u")D=new XMLSerializer;else{var de="object"==typeof process&&!process.browser,ye="object"==typeof Titanium;if("object"!=typeof exports||!de&&!ye)throw new Error("Unable to initialize serializer");D=new(require("@xmldom/xmldom").XMLSerializer)}function Y(e){return void 0!==e.xml?e.xml:D.serializeToString(e)}return{kml:function(e){for(var i={type:"FeatureCollection",features:[]},o={},y={},v={},S=["Polygon","LineString","Point","Track","gx:Track"],b=d(e,"Placemark"),P=d(e,"Style"),R=d(e,"StyleMap"),M=0;M<P.length;M++){var E=J(Y(P[M])).toString(16);o["#"+L(P[M],"id")]=E,y[E]=P[M]}for(var x=0;x<R.length;x++){o["#"+L(R[x],"id")]=J(Y(R[x])).toString(16);for(var F=d(R[x],"Pair"),z={},f=0;f<F.length;f++)z[l(r(F[f],"key"))]=l(r(F[f],"styleUrl"));v["#"+L(R[x],"id")]=z}for(var g=0;g<b.length;g++)i.features=i.features.concat(N(b[g]));function s(t){var a,p;return"#"===(t=t||"").substr(0,1)&&(t=t.substr(1)),(6===t.length||3===t.length)&&(a=t),8===t.length&&(p=parseInt(t.substr(0,2),16)/255,a="#"+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)),[a,isNaN(p)?void 0:p]}function m(t){return $(t.split(" "))}function h(t){var a=d(t,"coord"),p=[],n=[];0===a.length&&(a=d(t,"gx:coord"));for(var k=0;k<a.length;k++)p.push(m(l(a[k])));for(var T=d(t,"when"),c=0;c<T.length;c++)n.push(l(T[c]));return{coords:p,times:n}}function u(t){var a,p,n,k,T,c=[],G=[];if(r(t,"MultiGeometry"))return u(r(t,"MultiGeometry"));if(r(t,"MultiTrack"))return u(r(t,"MultiTrack"));if(r(t,"gx:MultiTrack"))return u(r(t,"gx:MultiTrack"));for(n=0;n<S.length;n++)if(p=d(t,S[n]))for(k=0;k<p.length;k++)if(a=p[k],"Point"===S[n])c.push({type:"Point",coordinates:j(l(r(a,"coordinates")))});else if("LineString"===S[n])c.push({type:"LineString",coordinates:K(l(r(a,"coordinates")))});else if("Polygon"===S[n]){var C=d(a,"LinearRing"),H=[];for(T=0;T<C.length;T++)H.push(K(l(r(C[T],"coordinates"))));c.push({type:"Polygon",coordinates:H})}else if("Track"===S[n]||"gx:Track"===S[n]){var w=h(a);c.push({type:"LineString",coordinates:w.coords}),w.times.length&&G.push(w.times)}return{geoms:c,coordTimes:G}}function N(t){var p,a=u(t),n={},k=l(r(t,"name")),T=l(r(t,"address")),c=l(r(t,"styleUrl")),G=l(r(t,"description")),C=r(t,"TimeSpan"),H=r(t,"TimeStamp"),w=r(t,"ExtendedData"),I=r(t,"LineStyle"),A=r(t,"PolyStyle"),Z=r(t,"visibility");if(!a.geoms.length)return[];if(k&&(n.name=k),T&&(n.address=T),c){"#"!==c[0]&&(c="#"+c),n.styleUrl=c,o[c]&&(n.styleHash=o[c]),v[c]&&(n.styleMapHash=v[c],n.styleHash=o[v[c].normal]);var X=y[n.styleHash];if(X){I||(I=r(X,"LineStyle")),A||(A=r(X,"PolyStyle"));var _=r(X,"IconStyle");if(_){var ee=r(_,"Icon");if(ee){var te=l(r(ee,"href"));te&&(n.icon=te)}}}}if(G&&(n.description=G),C){var Se=l(r(C,"begin")),ke=l(r(C,"end"));n.timespan={begin:Se,end:ke}}if(H&&(n.timestamp=l(r(H,"when"))),I){var re=s(l(r(I,"color"))),ie=re[0],ne=re[1],ae=parseFloat(l(r(I,"width")));ie&&(n.stroke=ie),isNaN(ne)||(n["stroke-opacity"]=ne),isNaN(ae)||(n["stroke-width"]=ae)}if(A){var oe=s(l(r(A,"color"))),se=oe[0],le=oe[1],fe=l(r(A,"fill")),ue=l(r(A,"outline"));se&&(n.fill=se),isNaN(le)||(n["fill-opacity"]=le),fe&&(n["fill-opacity"]="1"===fe?n["fill-opacity"]||1:0),ue&&(n["stroke-opacity"]="1"===ue?n["stroke-opacity"]||1:0)}if(w){var O=d(w,"Data"),q=d(w,"SimpleData");for(p=0;p<O.length;p++)n[O[p].getAttribute("name")]=l(r(O[p],"value"));for(p=0;p<q.length;p++)n[q[p].getAttribute("name")]=l(q[p])}Z&&(n.visibility=l(Z)),a.coordTimes.length&&(n.coordTimes=1===a.coordTimes.length?a.coordTimes[0]:a.coordTimes);var ge={type:"Feature",geometry:1===a.geoms.length?a.geoms[0]:{type:"GeometryCollection",geometries:a.geoms},properties:n};return L(t,"id")&&(ge.id=L(t,"id")),[ge]}return i},gpx:function(e){var i,b,f,g,o=d(e,"trk"),y=d(e,"rte"),v=d(e,"wpt"),S={type:"FeatureCollection",features:[]};for(i=0;i<o.length;i++)(b=M(o[i]))&&S.features.push(b);for(i=0;i<y.length;i++)(b=E(y[i]))&&S.features.push(b);for(i=0;i<v.length;i++)S.features.push((void 0,U(g=z(f=v[i]),B(f,["sym"])),{type:"Feature",properties:g,geometry:{type:"Point",coordinates:Q(f).coordinates}}));function P(f,g){for(var s=0;s<g;s++)f.push(null);return f}function R(f,g){var s=d(f,g),m=[],h=[],u=[],N=s.length;if(N<2)return{};for(var t=0;t<N;t++){var a=Q(s[t]);m.push(a.coordinates),a.time&&h.push(a.time),(a.heartRate||u.length)&&(u.length||P(u,t),u.push(a.heartRate||null))}return{line:m,times:h,heartRates:u}}function M(f){for(var u,g=d(f,"trkseg"),s=[],m=[],h=[],N=0;N<g.length;N++)if((u=R(g[N],"trkpt"))&&(u.line&&s.push(u.line),u.times&&u.times.length&&m.push(u.times),h.length||u.heartRates&&u.heartRates.length)){if(!h.length)for(var t=0;t<N;t++)h.push(P([],s[t].length));h.push(u.heartRates&&u.heartRates.length?u.heartRates:P([],u.line.length||0))}if(0!==s.length){var a=z(f);return U(a,F(r(f,"extensions"))),m.length&&(a.coordTimes=1===s.length?m[0]:m),h.length&&(a.heartRates=1===s.length?h[0]:h),{type:"Feature",properties:a,geometry:{type:1===s.length?"LineString":"MultiLineString",coordinates:1===s.length?s[0]:s}}}}function E(f){var g=R(f,"rtept");if(g.line){var s=z(f);return U(s,F(r(f,"extensions"))),{type:"Feature",properties:s,geometry:{type:"LineString",coordinates:g.line}}}}function F(f){var g={};if(f){var s=r(f,"line");if(s){var m=l(r(s,"color")),h=parseFloat(l(r(s,"opacity"))),u=parseFloat(l(r(s,"width")));m&&(g.stroke=m),isNaN(h)||(g["stroke-opacity"]=h),isNaN(u)||(g["stroke-width"]=96*u/25.4)}}return g}function z(f){var g=B(f,["name","cmt","desc","type","time","keywords"]),s=d(f,"link");s.length&&(g.links=[]);for(var h,m=0;m<s.length;m++)U(h={href:L(s[m],"href")},B(s[m],["text","type"])),g.links.push(h);return g}return S}}}();typeof module<"u"&&(module.exports=toGeoJSON);